#include <SPI.h>
#include <nRF24L01.h>
#include <RF24.h>
/*-----( Declare Constants and Pin Numbers )-----*/
#define CE_PIN   9
#define CSN_PIN 10

// NOTE: the "LL" at the end of the constant is "LongLong" type
const uint64_t pipe = 0xE8E8F0F0E1LL; // Define the transmit pipe


/*-----( Declare objects )-----*/
RF24 radio(CE_PIN, CSN_PIN); // Create a Radio
/*-----( Declare Variables )-----*/
int joystick[7];  

#include <VirtualWire.h>
const int rx_pin = 2;
const int tx_pin = 3;
void setup() {
   radio.begin();
  radio.openWritingPipe(pipe);
  Serial.begin(9600);
  pinMode(7, OUTPUT);
  pinMode(6, OUTPUT);
   pinMode(8, OUTPUT);
  vw_set_rx_pin(rx_pin);
  vw_set_ptt_inverted(true);
  vw_set_tx_pin(tx_pin);
  vw_setup(2000);
  vw_rx_start();
}
void loop() 
{
for(int i=21 ; i <=22; i++){
 unsigned int ind;
  byte TxBuffer[2];
  ind = i;
  TxBuffer[0] = ind >> 8;
  TxBuffer[1] = ind;
  digitalWrite(7, HIGH); 
  vw_send((byte *)TxBuffer, 2);
  vw_wait_tx(); 
    digitalWrite(7, LOW);
 
 if (ind ==21 )
 {
 uint8_t Buffer_Size = 2;
  unsigned int Data;
  uint8_t RxBuffer[Buffer_Size];
  Serial.println("response from node");
        Serial.println(ind);
        for (int t=0 ; t<=3 ; t++ )
        {
         
           if (vw_wait_rx_max(1000))  
  {
    digitalWrite(6, HIGH);
    if (vw_get_message(RxBuffer, &Buffer_Size)) // Non-blocking
    {
        joystick[t]= RxBuffer[0] << 8 | RxBuffer[1];
         Serial.println(joystick[t]);
         
         delay(100);
         digitalWrite(6, LOW);
         
    }    
    }
   
    else
  Serial.println("no response");
    }
  
       delay(500);
 }
    
 
 if (ind ==22 )
 {
 uint8_t Buffer_Size = 2;
  unsigned int Data;
  uint8_t RxBuffer[Buffer_Size];
  Serial.println("response from node");
        Serial.println(ind);
        for (int t=4 ; t<=6 ; t++ )
        {
           if (vw_wait_rx_max(1000))  
  {     
    digitalWrite(6, HIGH);
    
    if (vw_get_message(RxBuffer, &Buffer_Size)) // Non-blocking
    {
        joystick[t] = RxBuffer[0] << 8 | RxBuffer[1];
      Serial.println(joystick[t]);
             digitalWrite(6, LOW);
    }    
    }
   
    else
  Serial.println("no response");
  
    }
       delay(500);
 }
}
digitalWrite(8, HIGH);
radio.write( joystick, sizeof(joystick) );
delay(500);
digitalWrite(8, LOW);
              
}
